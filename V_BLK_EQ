               .OPTION LIST=SHOW_INCLUDES

;VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV
;
; VOICE CONTROL BLOCK:
; ONE PER VOICE, 8 TOTAL.  EACH CONSISTS OF A COMMON BLOCK CONTAINING INFORMATION PERTAINING TO
; PRIORITY-PHASE AND ASSIGNMENT STATUS, FIXED POINTERS TO HARDWARE ASSOCIATED WITH EACH VOICE,
; VELOCITY, VOLUME, PITCH, AND PAD POINTER INFO GENERATED DURING VOICE ASSIGN AND USED FOR SETUP,
; AND POINTERS TO THE IDLE AND ACTIVE VOICE CONTROL SUB-BLOCKS.  THE TWO SUB-BLOCKS ARE IDENTICAL
; AND ARE USED IN ALTERNATION TO ALLOW ONE TO BE SET UP WHILE OTHER IS STILL ACTIVE IN PLAYBACK.
; THEY CONTAIN ALL VECTORS AND VARIABLES NEEDED TO SUSTAIN SOUND PLAYBACK IN RESPONSE TO A SPECIFIC
; EVENT ONCE PLAYBACK HAS BEEN BEGUN BY THE PRIORITY VOICE-INITIALIZATION SEQUENCE.
; THE EVENT PARAMETERS THEMSELVES ARE KEPT IN THE COMMON BLOCK TO FACILITATE
; THE PROCESSES OF VOICE SETUP, VOICE-STEALING AND NOTE-OFF EVENT-TO-VOICE MATCHING.
; ALL VARIABLES IN THE VOICE CONTROL BLOCK HAVE LABELS WHICH BEGIN WITH "V_".
;
;
; VOICE CONTROL COMMON BLOCK:
;
V_PRIO_VEC     EQU     0                    ;WORD - VECTOR FOR PRIORITY-PHASE VOICE-START SEQUENCE.
V_PRIO_TIME    EQU     V_PRIO_VEC+2         ;WORD - PRIORITY-PHASE VECTOR SEQUENCING TIMER.
V_PRIO_FLAG    EQU     V_PRIO_TIME+2        ;BYTE - IF NOT = 0, NON-PRIORITY VOICE VECTORS BLOCKED.
V_CUE_LIST_FLAG EQU    V_PRIO_FLAG+1        ;BYTE - IF NOT = 0, VOICE BEING FIRED FROM CUE LIST.
;
V_CHIP_ADDR    EQU     V_CUE_LIST_FLAG+1    ;LONG - ADDRESS OF CHIP ASSIGNED TO THIS VOICE (FIXED).
V_CHIP_CHAN    EQU     V_CHIP_ADDR+4        ;WORD - CHIP CHANNEL (0 OR 1) ASSIGNED TO THIS VOICE.
V_CHIP_MISC    EQU     V_CHIP_CHAN+2        ;WORD - LAST CONTROL VALUE WRITTEN TO CHIP BY THIS
                                            ;       VOICE (L.S.BYTE ONLY) - USED BY PITCH BEND, SO
                                            ;       IT NEED NOT KEEP TRACK OF LOOP STATUS, ETC.
;
V_THIS_VOICE   EQU     V_CHIP_MISC+2        ;WORD - JUST A NUMBER 0-7 TO MARK WHICH VOICE THIS IS.
;
V_ACTIVE_SUB   EQU     V_THIS_VOICE+2       ;WORD - POINTER TO ACTIVE SUB-BLOCK.
V_IDLE_SUB     EQU     V_ACTIVE_SUB+2       ;WORD - POINTER TO IDLE SUB-BLOCK.
;
V_CTRL_ADDR    EQU     V_IDLE_SUB+2         ;LONG - POINTER TO CONTROL VOLTAGE SAMPLE/HOLD CHANNELS
                                            ;ASSIGNED TO THIS VOICE (FIXED - VCF, VCA, PAN AT THREE
                                            ;ADJACENT WORD ADDRESSES).
V_PAD_VAL_PTR  EQU     V_CTRL_ADDR+4        ;WORD - POINTER TO PAD_VALUE[n] WHEN THIS VOICE IS
                                            ;ASSIGNED TO AN EVENT FROM PAD n, FOR VELOCITY ACCESS.
;
V_VEL_LIST     EQU     V_PAD_VAL_PTR+2      ;WORD - BIT MAP OF VOICE INIT TASKS WHICH REQUIRE PAD
                                            ;VELOCITY VALUE TO PROCEED (NONE IF NOT A PAD EVENT -
                                            ;VELOCITY AVAILABLE IMMEDIATELY FROM MIDI OR SEQUENCE).
V_NON_VEL_LIST EQU     V_VEL_LIST+2         ;WORD - BIT MAP OF VOICE INIT TASKS NOT REQUIRING PAD
                                            ;VELOCITY VALUE TO PROCEED (ALL IF NOT A PAD EVENT -
                                            ;VELOCITY AVAILABLE IMMEDIATELY FROM MIDI OR SEQUENCE).
;
V_VELOCITY     EQU     V_NON_VEL_LIST+2     ;WORD - NORMALIZED EVENT VELOCITY FROM PAD, MIDI OR
                                            ;SEQUENCE - VALUE IN L.S.BYTE, M.S.BYTE ALWAYS = 0.
V_PITCH_DELTA  EQU     V_VELOCITY+2         ;WORD - EVENT PITCH DELTA RELATIVE TO SAMPLED PITCH -
                                            ;SEMITONE OFFSET, FULL WORD USED.
V_LEVEL        EQU     V_PITCH_DELTA+2      ;WORD - EVENT LEVEL SETTING FROM USER KIT, PRESET BANK
                                            ;OR SEQUENCE - VALUE IN L.S.BYTE, M.S.BYTE ALWAYS = 0.
V_PAN          EQU     V_LEVEL+2            ;WORD - EVENT PAN SETTING FROM USER KIT, PRESET BANK
                                            ;OR SEQUENCE - VALUE IN L.S.BYTE, M.S.BYTE ALWAYS = 0.
V_SOUND_ALT    EQU     V_PAN+2              ;WORD - SOUND NUMBER (SHIFTED LEFT BY 1) AND ALT-PARAMS
                                            ;BIT (IN BIT 0) FOR EVENT VOICE WAS LAST ASSIGNED TO.
;
V_P_OFF_TIME   EQU     V_SOUND_ALT+2        ;WORD - IF NOT = 0, INDICATES REAL_TIME AT WHICH A SEQ
                                            ;VOICE SHOULD GATE ITSELF OFF (PRE-FETCH DELAY).
                                            ;COMMON BLOCK VERSION IS USED ONLY IF SEQ NOTE-OFF IS
                                            ;ACKNOWLEDGED WHILE VOICE IS STILL IN PRIO SEQUENCE.
;
V_IDENTITY     EQU     V_P_OFF_TIME+2       ;LONG - CHARACTERIZES EVENT TO WHICH VOICE IS ASSIGNED,
                                            ;FOR EFFICIENT NOTE-OFF-EVENT-TO-VOICE MATCHING -
                                            ;ONLY THE NECESSARY AND SUFFICIENT INFO FOR MATCHING
                                            ;OF EVENTS FROM EACH EVENT SOURCE (PADS, MIDI, SEQ).
                                            ;FOR DETAILS, REFER TO MODULE ASSIGN.
;
V_COMMON_SIZE  EQU     V_IDENTITY+4         ;SIZE OF VOICE CONTROL COMMON BLOCK.
;
;
; VOICE CONTROL SUB-BLOCK:
;
V_SOUND_COM    EQU     0                    ;WORD - POINTER TO SOUND PARAMETER COMMON BLOCK.
V_SOUND_SUB    EQU     V_SOUND_COM+2        ;WORD - POINTER TO SELECTED SOUND PARAMETER SUB-BLOCK.
;
V_N_OFF_TIME   EQU     V_SOUND_SUB+2        ;WORD - IF NOT = 0, INDICATES REAL_TIME AT WHICH A SEQ
                                            ;VOICE SHOULD GATE ITSELF OFF (PRE-FETCH DELAY).
;
                                            ;NOTE - THE NEXT FOUR PARAMS ARE INITIALIZED IN A
                                            ;       BLOCK - WOE BE UNTO YOU IF YOU REARRANGE THEM!
V_VCA_VECTOR   EQU     V_N_OFF_TIME+2       ;WORD - NON-PRIORITY VCA ENVELOPE MAINTENANCE VECTOR.
V_CUR_VCA      EQU     V_VCA_VECTOR+2       ;LONG - CURRENT RAW VCA ENVELOPE POINT
                                            ;       (BEFORE SCALING BY V_A_SUS_LEVEL).
V_A_ATT_RATE   EQU     V_CUR_VCA+4          ;LONG - VCA ATTACK RATE FACTOR (ADJ'D PER PITCH, VEL).
V_A_ATT_TIME   EQU     V_A_ATT_RATE+4       ;WORD - NUMBER OF UPDATES FOR ATTACK TO COMPLETE.
;
V_A_SUS_LEVEL  EQU     V_A_ATT_TIME+2       ;WORD - VCA SUSTAIN LEVEL (ADJUSTED PER VELOCITY).
V_A_SUS_TIME   EQU     V_A_SUS_LEVEL+2      ;WORD - VCA SUSTAIN TIME - COUNTDOWN IF D15 = 0,
                                            ;       SUSTAIN WHILE GATE ON IF D15 = 1.
;
                                            ;NOTE - NEXT THREE PARAMS INITIALIZED IN A BLOCK -
                                            ;DON'T MESS 'EM AROUND.
V_A_REL_RATE   EQU     V_A_SUS_TIME+2       ;LONG - VCA RELEASE RATE FACTOR (ADJ'D PER PITCH, VEL).
V_A_REL_TIME   EQU     V_A_REL_RATE+4       ;WORD - NUMBER OF UPDATES FOR RELEASE TO COMPLETE.
V_A_REL_INDEX  EQU     V_A_REL_TIME+2       ;WORD - WORD-OFFSET FORM OF RELEASE TABLE INDEX USED
                                            ;       TO FETCH THE ABOVE TWO PARAMETERS.
;
;
                                            ;NOTE - THE NEXT THREE PARAMS ARE INITIALIZED IN A
                                            ;       BLOCK - WOE BE UNTO YOU IF YOU REARRANGE THEM!
V_VCF_VECTOR   EQU     V_A_REL_INDEX+2      ;WORD - NON-PRIORITY VCF ENVELOPE MAINTENANCE VECTOR.
V_CUR_VCF      EQU     V_VCF_VECTOR+2       ;WORD - CURRENT RAW VCF ENVELOPE POINT
                                            ;       (BEFORE SCALING BY V_F_SUS_LEVEL).
V_F_ATT_RATE   EQU     V_CUR_VCF+2          ;WORD - VCF ATTACK RATE DELTA (ADJ'D PER PITCH, VEL).
;
V_F_SUS_LEVEL  EQU     V_F_ATT_RATE+2       ;WORD - VCF SUSTAIN LEVEL (ADJUSTED PER VELOCITY).
V_F_SUS_TIME   EQU     V_F_SUS_LEVEL+2      ;WORD - VCF SUSTAIN TIME - COUNTDOWN IF D15 = 0,
                                            ;       SUSTAIN WHILE GATE ON IF D15 = 1.
V_F_REL_RATE   EQU     V_F_SUS_TIME+2       ;WORD - VCF RELEASE RATE DELTA (ADJ'D PER PITCH, VEL).
V_F_CUTOFF     EQU     V_F_REL_RATE+2       ;WORD - NON-ENVELOPED COMPONENT OF VCF VALUE
                                            ;       (ADJUSTED PER PITCH).
;
;
                                            ;NOTE - THE NEXT TWO PARAMS ARE INITIALIZED AS A PAIR -
                                            ;       WOE BE UNTO YOU IF YOU REARRANGE THEM!
V_BEND_VECTOR  EQU     V_F_CUTOFF+2         ;WORD - PITCH-BEND ENVELOPE MAINTENANCE VECTOR.
V_BEND_RATE    EQU     V_BEND_VECTOR+2      ;WORD - PITCH ENVELOPE RELEASE-RATE FACTOR - ADJUSTED
                                            ;       PER PITCH, VELOCITY.
V_BEND_LEVEL   EQU     V_BEND_RATE+2        ;WORD - COMBINED SCALE FACTOR FOR RAW PITCH ENVELOPE,
                                            ;       TO OBTAIN PITCH INDEX OFFSET - COMPRISES BASIC
                                            ;       BEND DEPTH SETTING ADJUSTED BY VELOCITY.
;
                                            ;NOTE - THE NEXT TWO PARAMS ARE INITIALIZED AS A PAIR -
                                            ;       WOE BE UNTO YOU IF YOU REARRANGE THEM!
V_FIN_PITCH    EQU     V_BEND_LEVEL+2       ;WORD - FINAL PITCH INDEX VALUE APPROACHED BY PITCH
                                            ;       BEND PROCESS.  REPRESENTS BASIC PITCH (PITCH
                                            ;       KNOB OR KEY NUMBER TRANSLATED VIA PITCH TABLE
                                            ;       WITH SAMPLE RATE, TUNING SETTINGS FACTORED IN).
V_CUR_PITCH    EQU     V_FIN_PITCH+2        ;WORD - CURRENT RAW PITCH ENV VALUE (BEFORE SCALING BY
                                            ;       V_BEND_LEVEL TO OBTAIN TUNE INDEX OFFSET).
;
;
V_PITCH_PAN    EQU     V_CUR_PITCH+2        ;WORD - VALUE OUTPUT TO PAN CTRL - INCLUDES PITCH-MOD.
;
V_START_ADDR   EQU     V_PITCH_PAN+2        ;LONG - PLAYBACK START ADDRESS, INCLUDING VELOCITY-MOD.
;
;
V_SUB_SIZE     EQU     V_START_ADDR+4                 ;SIZE OF VOICE CONTROL SUB-BLOCK.
V_SUB_0        EQU     V_COMMON_SIZE                  ;OFFSET OF SUB-BLOCK 0 INTO VOICE BLOCK.
V_SUB_1        EQU     V_SUB_0+V_SUB_SIZE             ;OFFSET OF SUB-BLOCK 1 INTO VOICE BLOCK.
V_BLOCK_SIZE   EQU     V_COMMON_SIZE+(2*V_SUB_SIZE)   ;SIZE OF COMPLETE VOICE CONTROL BLOCK.
;
;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
               .OPTION LIST="ON"
